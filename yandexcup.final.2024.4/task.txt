D. Средневековый DDoS (100 баллов)

Партия отправляла сообщения дублируя запросы.
Таким образом, тактика Дунлиньской партии по массовой отправке официальных запросов стала своеобразной древней версией DDoS-атаки. Но, к сожалению, сегодня подобные методы часто используются злоумышленниками для менее благородных целей.

Ваша задача — написать детектор, который сможет в онлайн-режиме отфильтровать большую часть запросов злоумышленников и не допустить даунтайма сервиса, в который эти запросы будут приходить после фильтрации. У вас в распоряжении будут данные запросов к серверу за один из дней, когда никакой подозрительной активности не наблюдалось.

Сервису выделено количество ресурсов, достаточное для обработки MAX_RPS × 2 запросов. Если на сервис приходит больше запросов, то он может уйти в даунтайм. Также будем считать сервер ушедшим в даунтайм, если были отфильтрованы запросы более половины добропорядочных пользователей за некоторый промежуток времени (~30 секунд). MAX_RPS — это максимум по секундному окну истории.

Формат ввода
Программа участника предоставляет интерактивный интерфейс.

Ваша программа будет запущена с единственным аргументом командной строки — путём к истории запросов за один из прошлых дней. История представляет собой CSV-файл со строками (каждая новая строка — отдельный запрос) следующего формата:

<timestamp>,<ipv4>,<payload>
Пример данных

1729641642625,110.124.0.105,602
1729641642717,110.124.3.94,603
1729641642809,110.124.0.160,604
Поле timestamp — это unix-like миллисекундный таймстемп, ipv4 — это IPv4, с которого был запрос, payload — хеш запроса, тип - строка. Все запросы в файле отсортированы по timestamp.

Как только очередь готова принимать сообщения, вы должны отправить команду START в stdout. Так тестирующая система узнает, что можно начинать взаимодействие.

Далее тестирующая система будет посылать в stdin команды:

REQ <timestamp> <ipv4> <payload>. Новый онлайн-запрос. После получения этой команды программа должна отправить в stdout строку OK, если запрос не нужно фильтровать, и DDOS — если запрос нужно отфильтровать как подозрительную активность. В stdin будет отправлен новый запрос только после того, как программа обработает решение по фильтрации предыдущего и отправит его в stdout.
SHUTDOWN. При получении этой команды программа должна завершиться с кодом 0.
Все приходящие в stdin запросы отсортированы по timestamp.

Ограничения:

максимально 1100 обычных клиентов;
максимально 1100 клиентов под контролем атакующих;
максимально 3000000 запросов в истории;
максимально 3000000 запросов приходящих онлайн всего;
проверочное окно доступности для количества запросов и количества отфильтрованных обычных юзеров — 30 секунд.
В зависимости от выбранного метода или языка запись в stdout в вашем решении может буферизоваться. Убедитесь, что каждая команда принудительно отправляется из буфера в stdout, иначе проверяющая система может не получать ваши ответы.

